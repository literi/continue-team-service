<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第三方应用 - OAuth2测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 0;
            display: inline-block;
            text-decoration: none;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .info {
            background-color: #e9ecef;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .code {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            margin: 10px 0;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>第三方应用 - OAuth2登录测试</h1>

        <div class="info">
            <h3>测试说明：</h3>
            <p>这个页面模拟第三方应用如何通过OAuth2进行用户登录。</p>
            <p><strong>测试账户：</strong>用户名: admin, 密码: 123456</p>
            <p><strong>客户端信息：</strong>client_id: client-app, client_secret: secret</p>
        </div>

        <h2>步骤1: 获取授权码</h2>
        <p>点击下面的按钮开始OAuth2授权流程：</p>
        <a href="http://localhost:8080/oauth2/authorize?response_type=code&client_id=client-app&redirect_uri=http://localhost:8081/login/oauth2/code/client-app&scope=openid profile" class="btn">
            开始OAuth2登录
        </a>

        <div class="info">
            <p>这将重定向到授权服务器的登录页面。使用 admin/123456 登录，然后同意授权。</p>
            <p>授权成功后，会重定向回这个页面并在URL中包含授权码。</p>
        </div>

        <h2>步骤2: 交换访问令牌</h2>
        <p>获取授权码后，使用以下命令交换访问令牌：</p>
        <div class="code">
curl -X POST http://localhost:8080/oauth2/token \
  -H "Content-Type: application/x-www-form-urlencoded" \
  -d "grant_type=authorization_code&client_id=client-app&client_secret=secret&code=YOUR_AUTH_CODE&redirect_uri=http://localhost:8081/login/oauth2/code/client-app"
        </div>

        <h2>步骤3: 使用访问令牌访问受保护资源</h2>
        <p>使用访问令牌访问API：</p>
        <div class="code">
curl -H "Authorization: Bearer YOUR_ACCESS_TOKEN" \
  http://localhost:8080/api/user
        </div>

        <h2>手动测试URL</h2>
        <ul>
            <li><a href="http://localhost:8080/login" target="_blank">登录页面</a></li>
            <li><a href="http://localhost:8080/" target="_blank">首页</a></li>
            <li><a href="http://localhost:8080/api/user" target="_blank">受保护的API (需要认证)</a></li>
        </ul>

        <div class="info">
            <h3>注意事项：</h3>
            <ul>
                <li>确保OAuth2服务器运行在 http://localhost:8080</li>
                <li>这个测试页面应该运行在不同的端口（如8081）以模拟第三方应用</li>
                <li>实际应用中，重定向URI应该与注册的客户端配置匹配</li>
            </ul>
        </div>
    </div>

    <script>
        // 解析URL中的授权码
        const urlParams = new URLSearchParams(window.location.search);
        const code = urlParams.get('code');
        if (code) {
            document.querySelector('.code').innerHTML = `curl -X POST http://localhost:8080/oauth2/token \\
  -H "Content-Type: application/x-www-form-urlencoded" \\
  -d "grant_type=authorization_code&client_id=client-app&client_secret=secret&code=${code}&redirect_uri=http://localhost:8081/login/oauth2/code/client-app"`;

            // 显示成功消息
            const successDiv = document.createElement('div');
            successDiv.className = 'info';
            successDiv.innerHTML = `<h3>✅ 授权成功！</h3><p>授权码: <code>${code}</code></p><p>现在可以使用上面的curl命令交换访问令牌。</p>`;
            document.querySelector('.container').insertBefore(successDiv, document.querySelector('h2'));
        }
    </script>
</body>
</html>